<script>
    function initializeChat() {
        document.getElementById("chat-box").innerHTML = `
            <div class="bot-message message">Welcome to the <b>Inheritance Tax MythBuster!</b> Iâ€™m here to help you separate fact from fiction when it comes to inheritance tax. Select a myth below, and Iâ€™ll provide you with accurate information.</div>
        `;
        showMyths();
    }

    function showMyths() {
        let chatBox = document.getElementById("chat-box");
        let optionsDiv = document.createElement("div");
        optionsDiv.id = "options";
        chatBox.appendChild(optionsDiv);

        let myths = [
            "ðŸ“Œ Myth: Surviving the 'seven-year clock' is all I have to worry about.",
            "ðŸ“Œ Myth: I have to wait seven years for a gift to be outside my estate for IHT.",
            "ðŸ“Œ Myth: My spouse or civil partner is always exempt from IHT.",
            "ðŸ“Œ Myth: Inheritance tax planning is a one-time activity.",
            "ðŸ“Œ Myth: Inheritance tax planning is only about property."
        ];

        myths.forEach((myth, index) => {
            let mythOption = document.createElement("div");
            mythOption.className = "bot-message message selectable";
            mythOption.innerHTML = myth;
            mythOption.onclick = function() { selectMyth(index + 1, myth); };
            optionsDiv.appendChild(mythOption);
        });

        autoScroll();
    }

    function selectMyth(option, selectedMyth) {
        let chatBox = document.getElementById("chat-box");

        let userMessage = document.createElement("div");
        userMessage.className = "user-message message";
        userMessage.innerHTML = selectedMyth;
        chatBox.appendChild(userMessage);

        let response = "";
        let typingTime = 2000;

        if (option === 1) {
            response = "âœ… <b>Fact:</b> Surviving seven years can make a gift IHT-exempt, but other taxes like Capital Gains Tax (CGT) may still apply. <br><br>" +
                       "If you gift property, shares, or other chargeable assets, you may face CGT if their value has increased since you acquired them, potentially creating an immediate tax liability. " +
                       "Additionally, anti-avoidance rules prevent you from benefiting from gifted assets. If you still use or control them, they may still count as part of your estate.<br><br>" +
                       "ðŸ”¹ <b>What you can do:</b> Gifting can still be tax-efficient, but **proper planning** is crucial. Consider the **CGT implications**, ensure you **fully give up control**, and be aware of **reporting requirements**.";
        } 
        else if (option === 2) {
            response = "âœ… <b>Fact:</b> While most gifts require a seven-year wait to become IHT-free, not all do. Some gifts are **immediately exempt**, depending on the circumstances. <br><br>" +
                       "Gifts to **UK charities** are fully exempt from IHT, and regular **gifts out of income** can also be immediately tax-free, provided they meet specific conditions.<br><br>" +
                       "ðŸ”¹ <b>What you can do:</b> Understanding IHT exemptions can help reduce your estateâ€™s tax burden. Be aware of the rules, document regular gifts properly, and seek guidance on maximizing tax-efficient transfers.";
        } 
        else if (option === 3) {
            response = "âœ… <b>Fact:</b> While gifts between spouses and civil partners are **generally IHT-free**, this only applies if both are **UK-domiciled**. If one partner is non-UK domiciled, the exemption may be **limited**.<br><br>" +
                       "Additionally, the **surviving spouse can inherit unused allowances**, including the **nil-rate band** and **residence nil-rate band**, potentially increasing their tax-free threshold.<br><br>" +
                       "ðŸ”¹ <b>What you can do:</b> If your spouse is non-UK domiciled, consider electing UK domicile for tax purposes or using other estate planning strategies to avoid unexpected IHT liabilities.";
        } 
        else if (option === 4) {
            response = "âœ… <b>Fact:</b> IHT planning isnâ€™t a **one-time event**â€”itâ€™s an **ongoing process**. Tax laws change, personal circumstances shift, and financial landscapes evolve, requiring periodic adjustments.<br><br>" +
                       "ðŸ”¹ <b>What you can do:</b> Regularly review your estate plan to ensure it remains tax-efficient and compliant with current regulations. Staying proactive helps avoid unnecessary tax burdens and keeps your plan effective.";
        } 
        else if (option === 5) {
            response = "âœ… <b>Fact:</b> While property is a **key part** of IHT planning, **other assets like investments, savings, and personal belongings** are also subject to tax.<br><br>" +
                       "ðŸ”¹ <b>What you can do:</b> Take a **holistic approach** to estate planning, ensuring all asset types are accounted for. A well-rounded strategy can help minimize tax liabilities across your entire estate.";
        }

        let typingIndicator = document.createElement("div");
        typingIndicator.className = "bot-message message typing-indicator";
        typingIndicator.innerHTML = "MythBuster is typing...";
        chatBox.appendChild(typingIndicator);

        autoScroll();

        setTimeout(() => {
            typingIndicator.remove();

            let botMessage = document.createElement("div");
            botMessage.className = "bot-message message";
            botMessage.innerHTML = response;
            chatBox.appendChild(botMessage);

            showMyths();
        }, typingTime);
    }

    function autoScroll() {
        let chatBox = document.getElementById("chat-box");
        setTimeout(() => {
            chatBox.scrollTop = chatBox.scrollHeight;
        }, 100);
    }

    function resetChat() {
        initializeChat();
    }

    initializeChat();
</script>
